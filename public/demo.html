<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexoBot Demo ‚Äî Prob√° la API en vivo</title>
    <meta name="description"
        content="Prob√° la API de NexoBot con datos de ejemplo. Consult√° NexoScore, GreenLight y Market Intelligence.">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;700&display=swap"
        rel="stylesheet">
    <style>
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg: #0A0E17;
            --bg-card: #111722;
            --bg-card2: #1A202E;
            --border: rgba(255, 255, 255, 0.06);
            --text: #F1F3F5;
            --text-sec: #9DA5B1;
            --text-muted: #5E6773;
            --green: #00B894;
            --green-bg: rgba(0, 184, 148, 0.1);
            --blue: #0984E3;
            --blue-bg: rgba(9, 132, 227, 0.1);
            --red: #E74C3C;
            --red-bg: rgba(231, 76, 60, 0.1);
            --yellow: #FDCB6E;
            --yellow-bg: rgba(253, 203, 110, 0.1);
            --accent: #6C5CE7;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--text);
            background: var(--bg);
            min-height: 100vh;
        }

        a {
            color: var(--green);
            text-decoration: none;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* HEADER */
        .header {
            padding: 20px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            font-size: 18px;
            font-weight: 800;
        }

        .logo span {
            color: var(--accent);
        }

        .demo-badge {
            font-size: 11px;
            font-weight: 700;
            background: var(--green-bg);
            color: var(--green);
            padding: 3px 10px;
            border-radius: 8px;
        }

        .header-links a {
            font-size: 13px;
            color: var(--text-sec);
            margin-left: 20px;
        }

        .header-links a:hover {
            color: white;
        }

        /* HERO */
        .demo-hero {
            padding: 48px 0 32px;
            text-align: center;
        }

        .demo-hero h1 {
            font-size: 32px;
            font-weight: 900;
        }

        .demo-hero p {
            color: var(--text-sec);
            font-size: 15px;
            margin-top: 8px;
        }

        /* TABS */
        .tabs {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 32px 0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 24px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-sec);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }

        .tab:hover {
            border-color: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .tab.active {
            background: var(--green-bg);
            border-color: var(--green);
            color: var(--green);
        }

        /* DEMO PANEL */
        .demo-panel {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 24px;
            margin-bottom: 48px;
            min-height: 500px;
        }

        /* LEFT: INPUT */
        .input-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
        }

        .input-panel h3 {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-sec);
            margin-bottom: 6px;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 10px 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-card2);
            color: white;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            outline: none;
        }

        .input-group input:focus {
            border-color: var(--green);
        }

        .sample-merchants {
            margin-top: 16px;
        }

        .sample-merchants h4 {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sample-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 10px 14px;
            background: var(--bg-card2);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 13px;
            cursor: pointer;
            margin-bottom: 6px;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }

        .sample-btn:hover {
            border-color: var(--green);
            background: rgba(0, 184, 148, 0.04);
        }

        .sample-btn .name {
            font-weight: 600;
        }

        .sample-btn .meta {
            color: var(--text-sec);
            font-size: 11px;
        }

        .run-btn {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(135deg, var(--green), #00D2A0);
            color: #000;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
            margin-top: 16px;
        }

        .run-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(0, 184, 148, 0.3);
        }

        /* RIGHT: OUTPUT */
        .output-panel {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        /* REQUEST */
        .request-block,
        .response-block {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }

        .block-header {
            padding: 12px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 13px;
            font-weight: 600;
        }

        .block-header .method {
            color: var(--green);
            font-weight: 700;
        }

        .block-header .status {
            font-size: 12px;
            padding: 3px 10px;
            border-radius: 6px;
        }

        .status-ok {
            background: var(--green-bg);
            color: var(--green);
        }

        .status-warn {
            background: var(--yellow-bg);
            color: var(--yellow);
        }

        .status-bad {
            background: var(--red-bg);
            color: var(--red);
        }

        .code-body {
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.7;
            overflow-x: auto;
            white-space: pre;
            color: #ABB2BF;
            min-height: 120px;
        }

        .json-key {
            color: #E06C75;
        }

        .json-str {
            color: #98C379;
        }

        .json-num {
            color: var(--yellow);
        }

        .json-bool {
            color: #56B6C2;
        }

        /* VISUAL CARDS */
        .visual-results {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .v-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }

        .v-card .v-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .v-card .v-value {
            font-size: 28px;
            font-weight: 900;
            margin-top: 4px;
        }

        .v-card .v-sub {
            font-size: 12px;
            color: var(--text-sec);
            margin-top: 2px;
        }

        /* SCORE GAUGE */
        .score-gauge {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
        }

        .gauge-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            margin: 0 auto 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: 900;
            position: relative;
        }

        .gauge-circle::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            border: 6px solid var(--border);
        }

        .gauge-label {
            font-size: 14px;
            font-weight: 700;
        }

        .gauge-sub {
            font-size: 13px;
            color: var(--text-sec);
            margin-top: 4px;
        }

        /* FOOTER */
        .demo-footer {
            padding: 32px 0;
            border-top: 1px solid var(--border);
            text-align: center;
            font-size: 13px;
            color: var(--text-muted);
        }

        /* LOADING ANIMATION */
        .loading {
            display: inline-block;
        }

        .loading span {
            animation: pulse 1.4s infinite;
            display: inline-block;
        }

        .loading span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .loading span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 0.3;
            }

            50% {
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .demo-panel {
                grid-template-columns: 1fr;
            }

            .visual-results {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <div class="header-left">
                <div class="logo">ü§ñ Nexo<span>Bot</span></div>
                <span class="demo-badge">DEMO INTERACTIVA</span>
            </div>
            <div class="header-links">
                <a href="/empresas.html">‚Üê Volver</a>
                <a href="/empresas.html#contacto">Contactar</a>
            </div>
        </div>

        <!-- HERO -->
        <div class="demo-hero">
            <h1>Prob√° la API en vivo</h1>
            <p>Seleccion√° un comerciante de ejemplo y mir√° qu√© data pod√©s obtener</p>
        </div>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('greenlight')">üö¶ GreenLight</button>
            <button class="tab" onclick="switchTab('score')">üìä NexoScore</button>
            <button class="tab" onclick="switchTab('intelligence')">üß† Intelligence</button>
        </div>

        <!-- DEMO PANEL -->
        <div class="demo-panel">
            <!-- LEFT INPUT -->
            <div class="input-panel">
                <h3>‚öôÔ∏è Par√°metros</h3>
                <div class="input-group">
                    <label>Tel√©fono del comerciante</label>
                    <input type="text" id="phoneInput" placeholder="0981 123 456" value="">
                </div>
                <div class="input-group" id="amountGroup" style="display:none">
                    <label>Monto a prestar (Gs.)</label>
                    <input type="text" id="amountInput" placeholder="10.000.000" value="10000000">
                </div>

                <div class="sample-merchants">
                    <h4>Comerciantes de ejemplo</h4>
                    <button class="sample-btn" onclick="selectMerchant('0981551234','Do√±a Mar√≠a - Almac√©n','almacen')">
                        <div class="name">üè™ Do√±a Mar√≠a</div>
                        <div class="meta">Almac√©n ¬∑ San Lorenzo ¬∑ 8 meses activa</div>
                    </button>
                    <button class="sample-btn"
                        onclick="selectMerchant('0971882345','Don Carlos - Ferreter√≠a','ferreteria')">
                        <div class="name">üîß Don Carlos</div>
                        <div class="meta">Ferreter√≠a ¬∑ Luque ¬∑ 14 meses activo</div>
                    </button>
                    <button class="sample-btn" onclick="selectMerchant('0982443456','Liz - Despensa','despensa')">
                        <div class="name">üõí Liz</div>
                        <div class="meta">Despensa ¬∑ Lambar√© ¬∑ 3 meses activa</div>
                    </button>
                    <button class="sample-btn" onclick="selectMerchant('0991774567','Roberto - Kiosco','kiosco')">
                        <div class="name">üç¨ Roberto</div>
                        <div class="meta">Kiosco ¬∑ Fernando de la Mora ¬∑ 1 mes activo</div>
                    </button>
                </div>

                <button class="run-btn" id="runBtn" onclick="runQuery()">
                    ‚ñ∂ Ejecutar consulta
                </button>
            </div>

            <!-- RIGHT OUTPUT -->
            <div class="output-panel" id="outputPanel">
                <div class="request-block">
                    <div class="block-header">
                        <span><span class="method">GET</span> <span
                                id="requestUrl">/api/greenlight?phone=...</span></span>
                        <span>Request</span>
                    </div>
                    <div class="code-body" id="requestBody">
                        <span style="color:var(--text-muted)">// Seleccion√° un comerciante y hac√© click en
                            "Ejecutar"</span>
                    </div>
                </div>

                <div class="response-block">
                    <div class="block-header">
                        <span>Response</span>
                        <span class="status status-ok" id="statusBadge" style="display:none">200 OK</span>
                    </div>
                    <div class="code-body" id="responseBody">
                        <span style="color:var(--text-muted)">// La respuesta de la API aparecer√° ac√°</span>
                    </div>
                </div>

                <div class="visual-results" id="visualResults" style="display:none"></div>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="demo-footer">
            <p>Esta demo usa datos simulados de comerciantes de ejemplo. Los datos reales est√°n disponibles a trav√©s de
                nuestra API.</p>
            <p style="margin-top:8px"><a href="/empresas.html#contacto">Solicit√° acceso a la API real ‚Üí</a></p>
        </div>
    </div>

    <script>
        // =========================================
        // SIMULATED MERCHANT DATA
        // =========================================
        const MERCHANTS = {
            '0981551234': {
                name: 'Do√±a Mar√≠a', business: 'Almac√©n El Sol', rubro: 'almacen',
                city: 'San Lorenzo', days_active: 242, registered: '2025-06-21',
                score: 78, grade: 'B+',
                avg_daily_sales: 850000, monthly_volume: 25500000,
                total_transactions: 1847, total_customers: 34,
                collection_rate: 0.82, fiado_rate: 0.35,
                growth_monthly: 12, consistency: 90,
                payment_reliability: 'HIGH', risk_level: 'LOW',
                suggested_max: 15000000
            },
            '0971882345': {
                name: 'Don Carlos', business: 'Ferreter√≠a L√≥pez', rubro: 'ferreteria',
                city: 'Luque', days_active: 425, registered: '2024-12-20',
                score: 85, grade: 'A-',
                avg_daily_sales: 1200000, monthly_volume: 36000000,
                total_transactions: 3210, total_customers: 67,
                collection_rate: 0.91, fiado_rate: 0.28,
                growth_monthly: 8, consistency: 95,
                payment_reliability: 'VERY_HIGH', risk_level: 'LOW',
                suggested_max: 25000000
            },
            '0982443456': {
                name: 'Liz', business: 'Despensa Liz', rubro: 'despensa',
                city: 'Lambar√©', days_active: 89, registered: '2025-11-22',
                score: 52, grade: 'C',
                avg_daily_sales: 420000, monthly_volume: 12600000,
                total_transactions: 312, total_customers: 18,
                collection_rate: 0.65, fiado_rate: 0.45,
                growth_monthly: 22, consistency: 60,
                payment_reliability: 'MEDIUM', risk_level: 'MEDIUM',
                suggested_max: 5000000
            },
            '0991774567': {
                name: 'Roberto', business: 'Kiosco Don Rober', rubro: 'kiosco',
                city: 'Fernando de la Mora', days_active: 28, registered: '2026-01-22',
                score: 31, grade: 'D',
                avg_daily_sales: 180000, monthly_volume: 5400000,
                total_transactions: 87, total_customers: 12,
                collection_rate: 0.45, fiado_rate: 0.55,
                growth_monthly: 0, consistency: 35,
                payment_reliability: 'LOW', risk_level: 'HIGH',
                suggested_max: 1500000
            }
        };

        const MARKET_DATA = {
            periodo: '2026-01',
            comerciantes_activos: 2450,
            volumen_mensual_gs: 12800000000,
            volumen_mensual_display: 'Gs. 12.8 mil millones',
            transacciones_mes: 89340,
            ticket_promedio: 143000,
            rubros_top: [
                { rubro: 'Almac√©n/Despensa', pct: 38, volume: 'Gs. 4.86B', growth: '+8%' },
                { rubro: 'Ferreter√≠a', pct: 18, volume: 'Gs. 2.30B', growth: '+12%' },
                { rubro: 'Kiosco', pct: 15, volume: 'Gs. 1.92B', growth: '+3%' },
                { rubro: 'Venta de ropa', pct: 12, volume: 'Gs. 1.54B', growth: '-2%' },
                { rubro: 'Otros', pct: 17, volume: 'Gs. 2.18B', growth: '+5%' }
            ],
            zonas_top: [
                { zona: 'San Lorenzo', comerciantes: 420, volumen: 'Gs. 2.1B' },
                { zona: 'Luque', comerciantes: 380, volumen: 'Gs. 1.9B' },
                { zona: 'Lambar√©', comerciantes: 310, volumen: 'Gs. 1.5B' },
                { zona: 'Fernando de la Mora', comerciantes: 290, volumen: 'Gs. 1.4B' }
            ],
            morosidad: {
                tasa_general: '18%',
                por_rubro: { 'Almac√©n': '15%', 'Ferreter√≠a': '12%', 'Kiosco': '25%', 'Ropa': '22%' }
            },
            tendencia: { crecimiento_mensual: '+6%', comerciantes_nuevos_mes: 180 }
        };

        let currentTab = 'greenlight';
        let currentPhone = '';

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('amountGroup').style.display = tab === 'greenlight' ? 'block' : 'none';

            const url = document.getElementById('requestUrl');
            if (tab === 'greenlight') url.textContent = '/api/greenlight?phone=...';
            else if (tab === 'score') url.textContent = '/api/score?phone=...';
            else url.textContent = '/api/intelligence?period=2026-01';

            // Reset output
            document.getElementById('responseBody').innerHTML = '<span style="color:var(--text-muted)">// Ejecut√° la consulta para ver el resultado</span>';
            document.getElementById('statusBadge').style.display = 'none';
            document.getElementById('visualResults').style.display = 'none';
        }

        function selectMerchant(phone, name, rubro) {
            currentPhone = phone;
            document.getElementById('phoneInput').value = phone;
        }

        function fmtGs(n) {
            return 'Gs. ' + n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }

        function colorForScore(score) {
            if (score >= 70) return 'var(--green)';
            if (score >= 50) return 'var(--yellow)';
            return 'var(--red)';
        }

        function runQuery() {
            const phone = document.getElementById('phoneInput').value.replace(/\s/g, '');
            const btn = document.getElementById('runBtn');

            if (currentTab !== 'intelligence' && !phone) {
                alert('Seleccion√° un comerciante primero');
                return;
            }

            btn.textContent = '‚è≥ Consultando...';
            btn.disabled = true;

            // Show request
            if (currentTab === 'greenlight') {
                const amt = document.getElementById('amountInput').value || '10000000';
                document.getElementById('requestUrl').textContent = `/api/greenlight?phone=${phone}&amount=${amt}`;
                document.getElementById('requestBody').innerHTML = formatJSON({
                    headers: { 'x-api-key': 'demo_key_xxxx', 'Content-Type': 'application/json' },
                    params: { phone, amount: parseInt(amt) }
                });
            } else if (currentTab === 'score') {
                document.getElementById('requestUrl').textContent = `/api/score?phone=${phone}`;
                document.getElementById('requestBody').innerHTML = formatJSON({
                    headers: { 'x-api-key': 'demo_key_xxxx' },
                    params: { phone }
                });
            } else {
                document.getElementById('requestUrl').textContent = '/api/intelligence?period=2026-01';
                document.getElementById('requestBody').innerHTML = formatJSON({
                    headers: { 'x-api-key': 'demo_key_xxxx' },
                    params: { period: '2026-01', region: 'central' }
                });
            }

            // Simulate API delay
            setTimeout(() => {
                btn.textContent = '‚ñ∂ Ejecutar consulta';
                btn.disabled = false;

                if (currentTab === 'intelligence') {
                    showIntelligence();
                } else {
                    const merchant = MERCHANTS[phone];
                    if (!merchant) {
                        document.getElementById('statusBadge').style.display = 'inline';
                        document.getElementById('statusBadge').className = 'status status-bad';
                        document.getElementById('statusBadge').textContent = '404 Not Found';
                        document.getElementById('responseBody').innerHTML = formatJSON({
                            error: 'MERCHANT_NOT_FOUND',
                            message: 'No se encontr√≥ comerciante con ese tel√©fono en NexoBot'
                        });
                        return;
                    }

                    if (currentTab === 'greenlight') showGreenLight(merchant);
                    else showScore(merchant);
                }
            }, 1200);
        }

        function showGreenLight(m) {
            const amt = parseInt(document.getElementById('amountInput').value) || 10000000;
            const approved = amt <= m.suggested_max;
            const decision = approved ? 'APPROVED' : 'DENIED';

            const response = {
                decision,
                nexo_score: m.score,
                grade: m.grade,
                merchant: { name: m.name, business: m.business, city: m.city, rubro: m.rubro },
                financial: {
                    avg_daily_sales: m.avg_daily_sales,
                    monthly_volume: m.monthly_volume,
                    collection_rate: (m.collection_rate * 100).toFixed(0) + '%',
                    fiado_rate: (m.fiado_rate * 100).toFixed(0) + '%',
                    days_active: m.days_active
                },
                risk: {
                    level: m.risk_level,
                    payment_reliability: m.payment_reliability,
                    suggested_max_credit: m.suggested_max,
                    requested_amount: amt,
                    debt_capacity_ratio: (amt / m.suggested_max * 100).toFixed(0) + '%'
                },
                timestamp: new Date().toISOString()
            };

            document.getElementById('statusBadge').style.display = 'inline';
            document.getElementById('statusBadge').className = `status ${approved ? 'status-ok' : 'status-bad'}`;
            document.getElementById('statusBadge').textContent = `200 OK ¬∑ ${approved ? '‚úÖ APPROVED' : '‚ùå DENIED'}`;
            document.getElementById('responseBody').innerHTML = formatJSON(response);

            // Visual cards
            const vis = document.getElementById('visualResults');
            vis.style.display = 'grid';
            vis.innerHTML = `
        <div class="v-card">
            <div class="v-label">Decisi√≥n</div>
            <div class="v-value" style="color:${approved ? 'var(--green)' : 'var(--red)'}; font-size:20px">
                ${approved ? '‚úÖ APROBADO' : '‚ùå DENEGADO'}
            </div>
            <div class="v-sub">${approved ? 'Cumple criterios' : 'Supera capacidad'}</div>
        </div>
        <div class="v-card">
            <div class="v-label">NexoScore</div>
            <div class="v-value" style="color:${colorForScore(m.score)}">${m.score}</div>
            <div class="v-sub">Grade: ${m.grade}</div>
        </div>
        <div class="v-card">
            <div class="v-label">Cr√©dito m√°ximo sugerido</div>
            <div class="v-value" style="font-size:18px">${fmtGs(m.suggested_max)}</div>
            <div class="v-sub">Pedido: ${fmtGs(amt)}</div>
        </div>
        <div class="v-card">
            <div class="v-label">Ventas diarias prom.</div>
            <div class="v-value" style="font-size:18px">${fmtGs(m.avg_daily_sales)}</div>
            <div class="v-sub">${m.days_active} d√≠as activo</div>
        </div>
        <div class="v-card">
            <div class="v-label">Tasa de cobro</div>
            <div class="v-value" style="color:${m.collection_rate >= 0.7 ? 'var(--green)' : 'var(--yellow)'}">${(m.collection_rate * 100).toFixed(0)}%</div>
            <div class="v-sub">De fiados cobrados</div>
        </div>
        <div class="v-card">
            <div class="v-label">Riesgo</div>
            <div class="v-value" style="color:${m.risk_level === 'LOW' ? 'var(--green)' : m.risk_level === 'MEDIUM' ? 'var(--yellow)' : 'var(--red)'}; font-size:20px">
                ${m.risk_level === 'LOW' ? 'üü¢ BAJO' : m.risk_level === 'MEDIUM' ? 'üü° MEDIO' : 'üî¥ ALTO'}
            </div>
            <div class="v-sub">Confiabilidad: ${m.payment_reliability}</div>
        </div>
    `;
        }

        function showScore(m) {
            const response = {
                phone: currentPhone,
                merchant: { name: m.name, business: m.business, city: m.city },
                score: m.score,
                grade: m.grade,
                factors: {
                    sales_volume: Math.min(100, Math.round(m.avg_daily_sales / 12000)),
                    collection_rate: Math.round(m.collection_rate * 100),
                    consistency: m.consistency,
                    growth: Math.min(100, 50 + m.growth_monthly * 2),
                    tenure: Math.min(100, Math.round(m.days_active / 3.65))
                },
                stats: {
                    days_active: m.days_active,
                    total_transactions: m.total_transactions,
                    total_customers: m.total_customers,
                    monthly_volume: m.monthly_volume,
                    avg_daily_sales: m.avg_daily_sales
                },
                recommendation: m.score >= 70 ? 'ELIGIBLE_FOR_CREDIT' : m.score >= 50 ? 'REVIEW_REQUIRED' : 'NOT_RECOMMENDED',
                timestamp: new Date().toISOString()
            };

            document.getElementById('statusBadge').style.display = 'inline';
            document.getElementById('statusBadge').className = 'status status-ok';
            document.getElementById('statusBadge').textContent = '200 OK';
            document.getElementById('responseBody').innerHTML = formatJSON(response);

            const vis = document.getElementById('visualResults');
            vis.style.display = 'grid';
            const f = response.factors;
            vis.innerHTML = `
        <div class="score-gauge" style="grid-column:1/-1">
            <div class="gauge-circle" style="border: 6px solid ${colorForScore(m.score)}; color: ${colorForScore(m.score)}">
                ${m.score}
            </div>
            <div class="gauge-label">NexoScore: ${m.grade}</div>
            <div class="gauge-sub">${response.recommendation === 'ELIGIBLE_FOR_CREDIT' ? '‚úÖ Elegible para cr√©dito' : response.recommendation === 'REVIEW_REQUIRED' ? '‚ö†Ô∏è Requiere revisi√≥n' : '‚ùå No recomendado'}</div>
        </div>
        <div class="v-card">
            <div class="v-label">Volumen ventas</div>
            <div class="v-value" style="color:${colorForScore(f.sales_volume)}">${f.sales_volume}</div>
            <div class="v-sub">de 100</div>
        </div>
        <div class="v-card">
            <div class="v-label">Tasa de cobro</div>
            <div class="v-value" style="color:${colorForScore(f.collection_rate)}">${f.collection_rate}</div>
            <div class="v-sub">de 100</div>
        </div>
        <div class="v-card">
            <div class="v-label">Consistencia</div>
            <div class="v-value" style="color:${colorForScore(f.consistency)}">${f.consistency}</div>
            <div class="v-sub">de 100</div>
        </div>
        <div class="v-card">
            <div class="v-label">Crecimiento</div>
            <div class="v-value" style="color:${colorForScore(f.growth)}">${f.growth}</div>
            <div class="v-sub">de 100</div>
        </div>
        <div class="v-card">
            <div class="v-label">Antig√ºedad</div>
            <div class="v-value" style="color:${colorForScore(f.tenure)}">${f.tenure}</div>
            <div class="v-sub">${m.days_active} d√≠as</div>
        </div>
        <div class="v-card">
            <div class="v-label">Transacciones</div>
            <div class="v-value" style="font-size:22px">${m.total_transactions.toLocaleString()}</div>
            <div class="v-sub">${m.total_customers} clientes</div>
        </div>
    `;
        }

        function showIntelligence() {
            const d = MARKET_DATA;
            document.getElementById('statusBadge').style.display = 'inline';
            document.getElementById('statusBadge').className = 'status status-ok';
            document.getElementById('statusBadge').textContent = '200 OK';
            document.getElementById('responseBody').innerHTML = formatJSON(d);

            const vis = document.getElementById('visualResults');
            vis.style.display = 'grid';
            vis.innerHTML = `
        <div class="v-card">
            <div class="v-label">Comerciantes activos</div>
            <div class="v-value" style="color:var(--green)">${d.comerciantes_activos.toLocaleString()}</div>
            <div class="v-sub">+${d.tendencia.comerciantes_nuevos_mes}/mes nuevos</div>
        </div>
        <div class="v-card">
            <div class="v-label">Volumen mensual</div>
            <div class="v-value" style="font-size:18px;color:var(--blue)">${d.volumen_mensual_display}</div>
            <div class="v-sub">${d.tendencia.crecimiento_mensual} vs mes ant.</div>
        </div>
        <div class="v-card">
            <div class="v-label">Ticket promedio</div>
            <div class="v-value" style="font-size:20px">${fmtGs(d.ticket_promedio)}</div>
            <div class="v-sub">${d.transacciones_mes.toLocaleString()} txns/mes</div>
        </div>
        <div class="v-card" style="grid-column:1/-1">
            <div class="v-label" style="margin-bottom:12px">Top rubros por volumen</div>
            ${d.rubros_top.map(r => `
                <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
                    <div style="flex:1;text-align:left;font-size:13px;font-weight:600">${r.rubro}</div>
                    <div style="flex:2;background:var(--bg-card2);border-radius:6px;height:24px;overflow:hidden">
                        <div style="width:${r.pct}%;height:100%;background:linear-gradient(90deg,var(--green),var(--blue));border-radius:6px;display:flex;align-items:center;padding-left:8px;font-size:11px;font-weight:600;color:#000">${r.pct}%</div>
                    </div>
                    <div style="width:90px;text-align:right;font-size:12px;color:var(--text-sec)">${r.volume}</div>
                    <div style="width:40px;text-align:right;font-size:12px;color:${r.growth.startsWith('+') ? 'var(--green)' : 'var(--red)'}">${r.growth}</div>
                </div>
            `).join('')}
        </div>
        <div class="v-card" style="grid-column:1/-1">
            <div class="v-label" style="margin-bottom:12px">Tasa de morosidad por rubro</div>
            <div style="display:flex;gap:16px;justify-content:center;flex-wrap:wrap">
                ${Object.entries(d.morosidad.por_rubro).map(([k, v]) => `
                    <div style="text-align:center">
                        <div style="font-size:24px;font-weight:900;color:${parseInt(v) > 20 ? 'var(--red)' : parseInt(v) > 15 ? 'var(--yellow)' : 'var(--green)'}">${v}</div>
                        <div style="font-size:11px;color:var(--text-sec)">${k}</div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
        }

        function formatJSON(obj) {
            const json = JSON.stringify(obj, null, 2);
            return json
                .replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
                .replace(/"([^"]+)":/g, '<span class="json-key">"$1"</span>:')
                .replace(/: "([^"]+)"/g, ': <span class="json-str">"$1"</span>')
                .replace(/: (\d+\.?\d*)/g, ': <span class="json-num">$1</span>')
                .replace(/: (true|false|null)/g, ': <span class="json-bool">$1</span>');
        }
    </script>

</body>

</html>